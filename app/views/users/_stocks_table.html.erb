<div class="row">
  <div class="col-10">
    <h3>Tracked Stocks
      <% if request.path == my_portfolio_path %>
        <small>(<%= stocks.count %>/10)</small>
      <% end %>
    </h3>
  </div>
  <div class="col-2 text-center">
    <%= link_to '', class: "no-text-decoration" do%>
      <h3><%= fa_icon "history", id: "stocks-table-refresh-icon"%></h3>
    <% end %>
  </div>
</div>

<table class="table table-striped table-hover" id="stock-tracker">
  <thead>
    <tr>
      <th scope="col">Ticker</th>
      <th scope="col">Company</th>
      <th scope="col", class="text-right">Lastest</th>
      <th scope="col", class="text-right">&#916;</th>
      <th scope="col", class="text-right">&#916;%</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
    <% stocks.each do |stock| %>
    <% quote = stock.get_quote %>
      <tr>
        <th scope="row" class="align-middle"><%= stock.ticker %></th>
        <td class="align-middle"><%= quote.company_name %></td>
        <td class="align-middle text-right"><%= number_to_currency(quote.latest_price) %></td>
        <td class="align-middle text-right"><%= render  "shared/format_stock_delta", change: quote.change %></td>
        <td class="align-middle text-right"><%= render  "shared/format_stock_delta_percent", change: quote.change, percent: quote.change_percent_s %></td>
        <td class="align-middle">
          <% if request.path == my_portfolio_path %>
            <%= link_to user_stock_path(stock), method: :delete,
              data: { confirm: "Are you sure you would like to stop tracking #{stock.ticker} (#{quote.company_name})?" } do%>
              <%= fa_icon "times", class: "text-danger" %>
            <% end %>
          <% else %>
            <% if current_user.stock_already_tracked?(stock.ticker) %>
              <%= fa_icon "check", class: "text-success" %>
            <% else %>
              <%= link_to user_stocks_path(user: current_user, ticker: stock.ticker), method: :post do%>
                <%= fa_icon "plus", class: "text-primary" %>
              <% end %>
            <% end %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
